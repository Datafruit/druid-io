---
layout: doc_page
---
# 保留或自动删除数据
  
协调器节点使用规则来确定应该从集群加载或删除哪些数据。恢复数据的规则是在协调器控制台设置 (http://coordinator_ip:port) 。

规则指明应该如何分配段给不同的历史节点和每一层应该存储多少个副段。规则也可能表明段应该什么时候从集群完全删除。
协调器从元数据存储加载一组规则。规则可能是特定于某个数据源和/或一组可以配置的默认规则。规则是按顺序阅读的,因此,排序规则是很重要的。
协调器将循环通过所有可用的段，每个段与第一规则匹配。每个段只能匹配一个规则。

注意:建议配置规则使用协调器控制台。然而,协调器节点有HTTP端点以编程方式配置规则。

更新规则时,这一变化直到下一次运行协调器时才反应。这在未来一段时间都是固定的。

加载规则
---------------

加载规则表明应该存多少副本段在服务器层。
### 永久的加载规则

永久的加载规则格式：

```json
{
  "type" : "loadForever",  
  "tieredReplicants": {
    "hot": 1,
    "_default_tier" : 1
  }
}
```

* `type` - 这应该总是“永久加载”
* `tieredReplicants` - 层名称是键，层的副本数是值JSON对象。


### 间隔地加载规则

间隔地加载规则格式如下：

```json
{
  "type" : "loadByInterval",
  "interval": "2012-01-01/2013-01-01",
  "tieredReplicants": {
    "hot": 1,
    "_default_tier" : 1
  }
}
```

* `type` - 这个应该总是“间隔加载”
* `interval` - 一个代表ISO-8601间隔的JSON对象
* `tieredReplicants` - 层名称是键，层的副本数是值JSON对象


### 周期加载规则

周期加载规则格式如下：
```json
{
  "type" : "loadByPeriod",
  "period" : "P1M",
  "tieredReplicants": {
      "hot": 1,
      "_default_tier" : 1
  }
}
```

* `type` - 这个应该总是“周期加载”
* `period` - 一个代表ISO-8601周期的JSON对象
* `tieredReplicants` - 层名称是键，层的副本数是值JSON对象

段间隔与指定周期不一样。如果周期与这个区间重叠，则规则匹配。
删除规则
----------

删除规则表明从集群中删除段的时间。
### 永久删除规则

永久删除规则格式：
```json
{
  "type" : "dropForever"  
}
```

* `type` - 这个应该总是“永久删除”

所有匹配这个规则的段应该从集群中删除。

### 区间删除规则

区间的删除规则格式：
```json
{
  "type" : "dropByInterval",
  "interval" : "2012-01-01/2013-01-01"
}
```

* `type` - 这个应该总是被“区间的删除”
* `interval` - 代表ISO-8601周期的JSON对象

如果区间包含区间段则删除该段。
### 周期删除规则

周期删除规则格式：
```json
{
  "type" : "dropByPeriod",
  "period" : "P1M"
}
```

* `type` - 这个应该总是“周期删除”
* `period` - 代表ISO-8601周期的JSON对象

段间隔与指定周期不一样。周期是指从过去某段时间到当前时间的一段时间。

# 永久的删除数据
 
Druid可以从集群中完全删除数据，包括元数据存储条目,从深存储中移除数据，任何标记为未使用的段（通过总是标记为未使用的规则从集群中删除段）。
你可以提交一个[强制关闭任务](../ingestion/tasks.html)到[索引服务](../design/indexing-service.html)去执行。